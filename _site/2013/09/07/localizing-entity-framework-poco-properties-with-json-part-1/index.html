<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Localizing Entity Framework POCO Properties with JSON - Part 1</title>
  <meta name="author" content="Andy Mehalick">
  <meta name="copyright" content="Andy Mehalick">
  <meta name="description" content="It’s day #1 on a new project demanding my favorite requirement: localization yay! The yay emphasize is mine because localization presents some thorny technic...">
  <meta itemprop="name" content="Localizing Entity Framework POCO Properties with JSON - Part 1">
  <meta itemprop="description" content="It’s day #1 on a new project demanding my favorite requirement: localization yay! The yay emphasize is mine because localization presents some thorny technical challenges that often pull along a trailer load of complexity. Framework tools make many of the localization tasks a breeze but there’s always that one piece just beyond .NET’s reach: storing localized text in a database. Since I’ve spent far too many hours (days?) wrestling with lookup table and lookup tables for lookup table solutions it’s time to start this project off with a simple and elegant solution – one that plays nice with Entity Framework and maybe even brings its own UI to the party.">
  <meta itemprop="image" content="">
  <meta property="og:title" content="Localizing Entity Framework POCO Properties with JSON - Part 1">
  <meta property="og:type" content="blog">
  <meta property="og:url" content="https://andy.mehalick.com/2013/09/07/localizing-entity-framework-poco-properties-with-json-part-1/">
  <meta property="og:image" content="">
  <meta property="og:site_name" content="Andy Mehalick">
  <meta property="og:description" content="It’s day #1 on a new project demanding my favorite requirement: localization yay! The yay emphasize is mine because localization presents some thorny technical challenges that often pull along a trailer load of complexity. Framework tools make many of the localization tasks a breeze but there’s always that one piece just beyond .NET’s reach: storing localized text in a database. Since I’ve spent far too many hours (days?) wrestling with lookup table and lookup tables for lookup table solutions it’s time to start this project off with a simple and elegant solution – one that plays nice with Entity Framework and maybe even brings its own UI to the party.">
  <meta property="fb:admins" content="">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Atomic+Age:400">
  <link rel="canonical" href="https://andy.mehalick.com/2013/09/07/localizing-entity-framework-poco-properties-with-json-part-1/">
  <link rel="alternate" type="application/rss+xml" title="Andy Mehalick" href="https://andy.mehalick.com/feed.xml">
  <link rel="me" type="text/html" href="https://plus.google.com/113902592100905338618">
  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
</head>

  
  <body>
  
    <header>
    <nav>
        <div class="page-width">
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/contact/">Contact</a></li>
            </ul>        
            <a id="rss" href="https://andy.mehalick.com/feed.xml" title="Subscribe to RSS"><img src="/content/images/rss-icon.png" alt="rss icon" width="32" height="32" /></a>
            <br class="clearer"/>
        </div>
    </nav>  
</header>
  
    <main id="main" class="page-width">
        <div class="padded">
            <div id="sidebar">
                <img src="/content/images/photo.jpg" alt="Andy Mehalick" width="140" height="170" />
            </div>
            <div id="site-header">
                <h1>Andy Mehalick</h1>
                <h2>Software Architect, Engineer, Designer</h2>
                <hr />
            </div>
            <div id="content">
              
              <article class="blog-post">
    <header>
        <h1 class="header"><a href="">Localizing Entity Framework POCO Properties with JSON - Part 1</a></h1>
        <div class="subheader">
            <time datetime="2013-09-07 00:00:00 +0300" pubdate>7 September 2013</time>   
        </div>
        <!--<ul class="social">
            <li><div class="fb-like" data-href="" data-send="true" data-show-faces="false"></div></li>
        </ul> -->
        <br class="clearer" />
    </header>
    <p>It’s day #1 on a new project demanding my favorite requirement: localization yay! The yay emphasize is mine because localization presents some thorny technical challenges that often pull along a trailer load of complexity. Framework tools make many of the localization tasks a breeze but there’s always that one piece just beyond .NET’s reach: storing localized text in a database. Since I’ve spent far too many hours (days?) wrestling with lookup table and lookup tables for lookup table solutions it’s time to start this project off with a simple and elegant solution – one that plays nice with Entity Framework and maybe even brings its own UI to the party.</p>

<p>My requirements are simple: I’m using EF code first and will need to store entities having multilanguage properties… and I want to work with a super-simple, elegant, unobtrusive API that reads like poetry. Spoiler alert — we’re bringing JSON to the party along with my new favorite NuGet package (ok dislaimer I wrote it).</p>

<p><img src="https://dl.dropboxusercontent.com/u/38696855/blog/7/localized-property.jpg" alt="" /></p>

<p>Let’s jump in — this tutorial will ditch the too-popular generic lookup table approach and store localized text for entities as key/value serialized JSON. Our JSON is simple, readable, and searchable. We’ll then use some simple extension methods from the NuGet package <a href="https://www.nuget.org/packages/OrangeJetpack.Localization">OrangeJetpack.Localization</a> to make getting and setting our localized text a breeze.</p>

<p>To peak ahead just a bit we’ll be using a regular EF POCO model and code-first migrations. We’ll work with an entity <strong>Planet</strong> having a <strong>PlanetId</strong> and a <strong>Name</strong> property that will eventually be localized to English, Russian, and Japanese. Ultimately it will look like this in our database:</p>

<p><img src="https://dl.dropboxusercontent.com/u/38696855/blog/7/8-28-2013%207-15-38%20PM.png" alt="" /></p>

<h2 id="setup">Setup</h2>

<p>To start things off new-up a fresh ASP.NET MVC web application. You can play along at home or download a working demo at: <a href="https://github.com/andy-mehalick/OrangeJetpack.LocalizationDemo">https://github.com/andy-mehalick/OrangeJetpack.LocalizationDemo</a>. Next we’ll add our simple EF POCO and DbContext classes:</p>

<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">Planet</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">Key</span><span class="p">,</span> <span class="nf">DatabaseGenerated</span><span class="p">(</span><span class="n">DatabaseGeneratedOption</span><span class="p">.</span><span class="n">Identity</span><span class="p">)]</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">PlanetId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="p">[</span><span class="n">Required</span><span class="p">]</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">PlanetsContext</span> <span class="p">:</span> <span class="n">DbContext</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">DbSet</span><span class="p">&lt;</span><span class="n">planet</span><span class="p">&gt;</span> <span class="n">Planets</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>We’ll then let code first migrations create our local db with some Powershell in Package Manager Console:</p>

<pre class="cmd">PM&gt; Enable-Migrations</pre>

<pre class="cmd">PM&gt; Add-Migrations AddPlanet</pre>

<pre class="cmd">PM&gt; Update-Database</pre>

<p>Finally, let’s add a HomeController with Index() and scaffold a list view.</p>

<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">HomeController</span> <span class="p">:</span> <span class="n">Controller</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">PlanetsContext</span> <span class="n">_db</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PlanetsContext</span><span class="p">();</span>

    <span class="k">public</span> <span class="n">ActionResult</span> <span class="nf">Index</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">var</span> <span class="n">planets</span> <span class="p">=</span> <span class="n">_db</span><span class="p">.</span><span class="n">Planets</span><span class="p">.</span><span class="nf">ToList</span><span class="p">();</span>

        <span class="k">return</span> <span class="nf">View</span><span class="p">(</span><span class="n">planets</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>Snap your fingers to add some sample data and you should see:</p>

<p><img src="https://dl.dropboxusercontent.com/u/38696855/blog/7/8-28-2013%207-36-35%20PM.png" alt="" /></p>

<p>Eesh, close but let’s now show the localized content only.</p>

<h2 id="nuget-and-orangejetpacklocalizationmvc">NuGet and OrangeJetpack.Localization.Mvc</h2>

<p>Start by added the NuGet package <a href="https://www.nuget.org/packages/OrangeJetpack.Localization.Mvc">OrangeJetpack.Localization.Mvc</a> (it will drag its dependency <a href="https://www.nuget.org/packages/OrangeJetpack.Localization">OrangeJetpack.Localization</a> along with it):</p>

<pre class="cmd">PM&gt; Install-Package OrangeJetpack.Localization.Mvc</pre>

<p>This package will add a LocalizationLanguages property to app settings, let’s add the language codes for English, Russian, and Japanese:</p>

<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;appSettings&gt;</span>
        <span class="nt">&lt;add</span> <span class="na">key=</span><span class="s">"LocalizationLanguages"</span> <span class="na">value=</span><span class="s">"en,ru,ja"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/appSettings&gt;</span>
<span class="nt">&lt;/configuration&gt;</span></code></pre></div>

<p>Finally, let’s update Planet to indicate it is localizable and that Planet.Name is localized – we can do this by implementing ILocalizable and decorating Name with LocalizedAttribute:</p>

<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">Planet</span> <span class="p">:</span> <span class="n">ILocalizable</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">Key</span><span class="p">,</span> <span class="nf">DatabaseGenerated</span><span class="p">(</span><span class="n">DatabaseGeneratedOption</span><span class="p">.</span><span class="n">Identity</span><span class="p">)]</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">PlanetId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="p">[</span><span class="n">Required</span><span class="p">,</span> <span class="n">Localized</span><span class="p">]</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>This now generously grants us access to an IEnumerable<ilocalizeable>.Localize() extension method. This method accepts a language code and a list of properties to localize.</ilocalizeable></p>

<p>Back to HomeController.Index(), add an optional langCode input parameter and change _db.Planets.ToList() to _db.Planets.Localize(langCode, I =&gt; i.Name):</p>

<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">HomeController</span> <span class="p">:</span> <span class="n">Controller</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">PlanetsContext</span> <span class="n">_db</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PlanetsContext</span><span class="p">();</span>

    <span class="k">public</span> <span class="n">ActionResult</span> <span class="nf">Index</span><span class="p">(</span><span class="kt">string</span> <span class="n">langCode</span> <span class="p">=</span> <span class="s">"en"</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">var</span> <span class="n">planets</span> <span class="p">=</span> <span class="n">_db</span><span class="p">.</span><span class="n">Planets</span><span class="p">.</span><span class="nf">Localize</span><span class="p">(</span><span class="n">langCode</span><span class="p">,</span> <span class="n">i</span> <span class="p">=&gt;</span> <span class="n">i</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>

        <span class="k">return</span> <span class="nf">View</span><span class="p">(</span><span class="n">planets</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>Of course we could get language code from the user’s web browser or a profile setting but let’s keep it simple for now. If we omit a language code or use an unsupported one it will default to the first language in our app settings, “en” by default. Let’s run it again passing in the language code for Russian:</p>

<p><img src="https://dl.dropboxusercontent.com/u/38696855/blog/7/8-28-2013%207-59-35%20PM.png" alt="" /></p>

<p>Here’s what it would look like with no language, Japanese, or an unknown language:</p>

<p><img src="https://dl.dropboxusercontent.com/u/38696855/blog/7/8-28-2013%208-54-38%20PM.png" alt="" /></p>

<h2 id="multiple-localized-properties">Multiple Localized Properties</h2>

<p>Finally, one bonus of our extension method Localize() is its support for multiple properties; if Planet had additional localized properties we could pass them in as a params[] list:</p>

<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="n">_db</span><span class="p">.</span><span class="n">Planets</span><span class="p">.</span><span class="nf">Localize</span><span class="p">(</span><span class="n">langCode</span><span class="p">,</span> <span class="n">i</span> <span class="p">=&gt;</span> <span class="n">i</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">i</span> <span class="p">=&gt;</span> <span class="n">i</span><span class="p">.</span><span class="n">Description</span><span class="p">,</span> <span class="n">i</span> <span class="p">=&gt;</span> <span class="n">i</span><span class="p">.</span><span class="n">Atmosphere</span><span class="p">);</span></code></pre></div>

<h2 id="conclusion">Conclusion</h2>

<p>That’s it for now, in Part 2 we’ll look at adding and updating our localizable entities with the included editor template for MVC and eventually we’ll dig deeper in OrangeJetpack.Localization implementation. If you want to jump ahead you can find the project at <a href="https://github.com/andy-mehalick/OrangeJetpack.Localization">https://github.com/andy-mehalick/OrangeJetpack.Localization</a>.</p>

</article>

<div id="disqus_thread"></div>

<script>
    //var disqus_developer = parseInt(@(Request.IsLocal ? 1 : 0));
    var disqus_shortname = "andymehalick";
    var disqus_identifier = "7";
    var disqus_title = "Localizing Entity Framework POCO Properties with JSON - Part 1";
    (function () {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
              
            </div>       
        </div>
    </main>
  
    <footer id="site-footer">
    All site design and development by <a rel="author" href="https://plus.google.com/113902592100905338618">Andy Mehalick</a>.
</footer>
  
    <div id="fb-root"></div>
  
  </body>

</html>
